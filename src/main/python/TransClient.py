import sys
import thrift
sys.path.append('gen-py')

from TrafficDataTrans import TrafficDataService
from TrafficDataTrans.ttypes import *
#from TrafficDataTrans.ttypes import *

from thrift import Thrift
from thrift.transport import TSocket
from thrift.transport import TTransport
from thrift.protocol import TBinaryProtocol

try:
    transport = TSocket.TSocket('localhost', 9095)
    transport = TTransport.TBufferedTransport(transport)
    protocol = TBinaryProtocol.TBinaryProtocol(transport)
    client = TrafficDataService.Client(protocol)
    transport.open()

    #nowtraffic = [0.1, 0.2, 0.3, 0.4]
    #time = 0.15
    time = 0.0
    #nowtraffic = [0.481, 0.497, 0.493, 0.504, 0.518, 0.535, 0.527, 0.481, 0.475, 0.491, 0.493, 0.495, 0.510, 0.508, 0.525, 0.522, 0.512, 0.518, 0.522, 0.525, 0.508, 0.512, 0.456, 0.447, 0.443, 0.443, 0.462, 0.477, 0.472, 0.485]
    #nowtraffic = [0, 0.004166667, 0.008333333, 0.0125, 0.029166667, 0.03125, 0.04375, 0.060416667, 0.06875, 0.06875, 0.079166667, 0.079166667, 0.079166667, 0.0875,	0.1, 0.104166667, 0.120833333, 0.141666667, 0.147916667, 0.15, 0.175, 0.183333333, 0.233333333, 0.233333333, 0.235416667, 0.245833333, 0.25, 0.304166667, 0.310416667, 0.314583333]
    #nowtraffic2 = [0.1, 0.104166667, 0.120833333, 0.141666667, 0.147916667, 0.15, 0.175, 0.183333333, 0.233333333, 0.233333333, 0.235416667, 0.245833333, 0.25, 0.304166667, 0.310416667, 0.314583333	, 0.339583333, 0.352083333, 0.366666667, 0.410416667	, 0.43125, 0.477083333, 0.472916667, 0.485416667, 0.48125, 0.485416667, 0.48125, 0.477083333, 0.4875, 0.4875]
    #nowtraffic3 = [0.53125,	0.533333333,	0.535416667,	0.547916667,	0.522916667,	0.510416667, 0.533333333, 0.560416667, 0.5875, 0.591666667, 0.604166667, 0.597916667, 0.570833333, 0.595833333, 0.575, 0.585416667, 0.58125, 0.570833333, 0.566666667, 0.59375, 0.575, 0.564583333, 0.572916667, 0.558333333, 0.525, 0.49375, 0.502083333, 0.508333333, 0.5125, 0.495833333]
    #nowtraffic4 = [0.585416667, 0.58125, 0.570833333, 0.566666667, 0.59375, 0.575, 0.564583333, 0.572916667, 0.558333333, 0.525, 0.49375, 0.502083333, 0.508333333, 0.5125, 0.495833333, 0.477083333, 0.447916667, 0.447916667, 0.416666667, 0.422916667, 0.40625, 0.360416667, 0.364583333, 0.358333333, 0.329166667, 0.308333333, 0.272916667, 0.245833333, 0.254166667, 0.23125]
    #nowtraffic5 = [0.522916667, 0.5125, 0.51875, 0.522916667, 0.525, 0.508333333, 0.5125, 0.45625, 0.447916667, 0.44375, 0.44375, 0.4625, 0.477083333, 0.472916667, 0.485416667, 0.4875, 0.491666667, 0.447916667, 0.460416667, 0.46875, 0.45625, 0.425, 0.435416667, 0.429166667, 0.414583333, 0.425, 0.420833333, 0.420833333, 0.416666667, 0.441666667]
    #data = NowAreaTrafficData(areaId ="1", timeOfHour=time, nowAreaTraffic=nowtraffic)
    nowedegetraffic = []
    nodeSequence = [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    now_edge_traffic = [0, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.066666667, 0.083333333, 0.083333333, 0.083333333, 0.083333333, 0.116666667, 0.116666667, 0.15, 0.15, 0.15, 0.133333333, 0.133333333, 0.166666667, 0.166666667, 0.166666667]
    #data = NowAreaTrafficData(areaId="1", timeOfHour=0.45833, nowAreaTraffic=nowtraffic5)
    data = NowEdgeTrafficData(nodeSequence=nodeSequence, timeOfHour=time, nowEdgeTraffic=now_edge_traffic)
    predictedData = client.getEdgePredictedData(nowEdgeTrafficData = data)
    print(predictedData)

except Thrift.TException as ex:
    print("%s" % (ex.message))